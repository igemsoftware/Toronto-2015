% Preamble and some settings
\input{tex/preamble}

\graphicspath{{./figures/}}

\hypersetup{
    colorlinks=true,
    linkcolor=black,
    urlcolor=cyan
}

% Title
\title{MetaFlux: A Dank Framework}
\author{iGEM UofT}
\date{Julian Mazzitelli}

% Remove title from table of contents
\renewcommand*\contentsname{}

% Link shortcuts
\def\Blender{\href{https://www.blender.org/}{Blender}}

% Italicization shortcuts
\def\MetaFlux{\textit{MetaFlux}}
\def\SMBL{\href{http://sbml.org/Main_Page}{SMBL}}

\begin{document}

\maketitle

% \thispagestyle{empty}

% \begin{bottompar}
% \tableofcontents
% \end{bottompar}

% \newpage
% \setcounter{page}{1}

\section{Introduction}

Given the rapid advancements in genome-scale reconstructions and metagenomics
over the past several years [ref.], there is a need to effectively and succintly
analyze and interpret this data. We present \MetaFlux, a web based tool for
visualing, modifying, and comparing analyses of genome scale metabolic models.
\MetaFlux\ can dynamically present community level interactions as well as single
species models. [How to write as one sentence?]

\section{Data}

\MetaFlux\ visualizes genome models. Currently, the models available within our
app are \textit{Systems Biology Markup Language} (\SMBL) formatted models as
\texttt{xml} files taken from the literature [refs.]. We are interested in
incorporating autogenerated models from tools such as MicrobesFlux and Model
SEED in the future. Morever, the ability for a user to upload a model will be
implemented.

\subsection{Model Schema For Single Species}

The following is a BSON implementation of an SMBL metabolite model schema which
can be saved in a MongoDB NoSQL database. The following snippet is directly
operable within a NodeJS environment.

\inputminted{js}{snippets/MetabolicModel.js}

These are all of the properties present in the literature retreived models.
However, further attributes (such as \texttt{flux\_value}) will be appended
into the model.

\subsection{Model Schema for Community Structure}

In our community level representations, different species are described using
seperate compartments. Reactions involving shared extracellular metabolites
are constructed for each specie to mediate meteabolite exchange through the
extracellular space.

\section{Visualization}

From a community level, one may see the following visualization:

\input{tex/community-visualization}

In the above graphic each arrow represents an enzmyatic mediated reaction.
\textit{E.C.} represents the species \textit{E. Coli} and \textit{P.P.}
represents \textit{P. Putida}. \textit{A} is a metabolite exported by
\textit{E.C} and imported by \textit{P.P}. \textit{B} and \textit{C} are
metabolites exported by \textit{P.P.} \textit{D} is a metabolite which is
imported by both species, and potentially conferring to a competitive
relationship. Finally, \textit{E} is a metabolite imported into \textit{E.
Coli}. We arrive at set of potential relationships between two species
\textit{a,b} and a metabolite \textit{m}:

\begin{itemize}

\item Single species exporting a metabolite: $\{a,b\} \rightarrow m$
\item Single species importing a metabilte: $m \rightarrow \{a,b\}$
\item Synergistic export/import between two species: $\{a \rightarrow m \rightarrow b, b \rightarrow m \rightarrow a \}$
\item Competition for a metabolite between two species: $\{m \rightarrow a,b \}$

\end{itemize}

Given the above definition, we can generalize to any number of ``compartments''
and any number of metabolites. Furthermore, this additionally provides the means
to segregate the intracellular compartments of a single species model, such as
the cytosol, periplasm, and internal subsystems. The ability to create new
subsystems from within the web interface will be added in a later release.

\section{Graph Construction}

Once we have been provided with model data in the schema format as described
above, so begins the graph construction process. This process aims to be
as parametizable and generalizable as possible, in order to accomodate
the creation of custom groupings.

The first thing to do is construct \texttt{Metabolite} and \texttt{Reaction}
objects.

\begin{minted}{coffee}
buildPeices = (model) ->
    nodes = {}, reactions = {}

    for metabolite in model.metabolites
        nodes[metabolite.id] = new Metabolite(metabolite, ...)

    for reaction in model.reactions
        reactions[reaction.id] = new Reaction(reaction, ...)

        for metabolite of reaction.metabolites
            if reaction.metabolites[metabolite] > 0
                source = reaction.id
                target = metabolite
            else
                source = metabolite
                target = reaction.id

            reactions.addLink(new Link(source, target, ..))
\end{minted}

After this is done, we have two dictonaries storing all metabolites and
reactions that will be used to construct our system. The next step is to use the
prototype methods of the \texttt{Reaction} object to construct ``compartments''
as necessary. This will be done recursively, and with paramaters and defaults
outling the sets of compartments. For example, one set could be $\{E.C.,
extracellular, P.P.\}$, while another, nested within \textit{E.C.} could be
$\{cytosol, periplasm, extracellular\}$.

\begin{minted}{coffee}

# Will be called recursively
# The first call will pass in nodes, reactions
# set of reaction types? can be built w/ reactions
# Constructs a graph object
compartmentatilization = (system) ->
    # TODO

\end{minted}

\end{document}
